## Docker

Docker - это технология, позволяющая запускать приложения в виде так называемых контейнеров - набора изолированных от основной системы процессов.
Это намного удобнее и быстрее, чем настраивать виртуальные машины, поэтому Docker приобрел огромную популярность, и умение им пользоваться является стандартом для любого backend разработчика.

Отличное и короткое [видео](https://www.youtube.com/watch?v=VeiddqzBMls) про Docker.

Также в курсе Java Advanced на платформе первая глава посвящена Docker.

## Установка
Docker Desktop - это приложение, в которое входит движок Docker, утилита командной строки docker, docker compose и графический интерфейс.
1. Скачайте и запустите [установщик](https://www.docker.com/products/docker-desktop/)
2. Следуйте инструкциями во время установки
3. На Windows системах необходимо включить WSL 2 - технологию, позволяющую запускать дистрибутивы Linux без необходимости создавать виртуальную машину. Установщик предложит это сделать.
4. В терминале/powershell выполните команду <code>docker version</code>, чтобы убедиться, что установка прошла успешно.
5. Также теперь у вас есть графическое приложение Docker desktop, через которое можно управлять образами и контейнерами, ознакомьтесь с ним.

## DockerFile
DockerFile - это файл, в котором описаны шаги для создания образа. [Видео](https://www.youtube.com/watch?v=ZB8JBWriDVo) про Dockerfile.

Ознакомьтесь с Dockerfile в нашем репозитории, попробуй собрать образ нашего приложения:
1. Скомпилируйте наше приложение.
2. Находясь в корне проекта, выполните <code>docker build -f Dockerfile_Gazon -t gazon-service .</code>

## Запуск

Запустим БД и наше приложение с помощью docker CLI (Command-line interface).
1. Выполните следующую команду, чтобы запустить контейнер postgres. Образ скачается из [Docker Hub](https://hub.docker.com/search?q=).
<code>docker run --name postgreGazon -e POSTGRES_DB=gazon_db -e POSTGRES_USER=root -e POSTGRES_PASSWORD=root -p 5432:5432 -d postgres:12.12</code>
2. Выполните следующую команду, чтобы запустиь контейнер нашего приложения, образ которого мы создали на предыдущем шаге.
<code>docker run --link postgreGazon --name gazon-service -e SPRING_DATASOURCE_URL=jdbc:postgresql://postgreGazon:5432/gazon_db -p 8080:8080 -p 5005:5005 -d gazon-service:latest</code>
3. Попробуйте перейти на http://localhost:8080/swagger-ui/

Обратите внимание на то, что на втором шаге нам пришлось добавить <code>--link postgreGazon</code> и переопределить <code>SPRING_DATASOURCE_URL</code> для того, чтобы контейнеры БД и нашего приложения могли общаться друг с другом.

На реальных микросервисных проектах у одного микросервиса (и его дублей) всегда своя БД. На учебном проекте мы используем одну БД для всех микросервисов, чтобы проект легче запускался у студентов со слабым железом.

> Важно! В реальных проектах БД не поднимается в контейнере, а у одного микросервиса (и его дублей) всегда своя собственная БД. На учебном проекте мы поднимаем БД в Docker для удобства и используем одну БД для всех микросервисов, чтобы проект легче запускался у студентов со слабым железом. В реальных проектах БД следует задеплоить на отдельные сервера.

## Docker Compose
Docker Compose - это инструмент, который позволяет одновременно запустить несколько контейнеров и настроить взаимодействие между ними.

Благодаря docker compose, вместо написания громоздких команд в терминале, как в предыдущей главе, мы можем один раз создать файл docker-compose.yml и запускать связанные контейнеры командой <code>docker-compose up</code>, находясь в директории с docker-compose.yml.
Попробуйте это сделать и снова перейти на http://localhost:8080/swagger-ui/.

Обратите внимание, что образы в нашем docker-compose.yml имеют префикс denispronin/. Это значит, что Docker попытается найти эти образы в моем репозитории на Docker Hub, и если там их там нет, то они будут собраны локально. Это было сделано для удобства команды фронтов, использующей наш docker-compose.yml. Чтобы использовались локальные образы, которые мы собирали в предыдущих секциях, достаточно удалить префикс.

> Для дальнейшей разработки нашего проекта вы можете поднимать контейнеры так, как вам удобно. Например, я поднимаю контейнер с БД, а само приложение запускаю через Идею.